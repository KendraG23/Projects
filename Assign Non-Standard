	
SELECT DISTINCT B.AID_YEAR, A.EMPLID, A.NAME, C.STRM, B.PROCESSING_STATUS, B.SFA_REVIEW_STATUS, TO_CHAR(J.TERM_BEGIN_DT,'YYYY-MM-DD'), TO_CHAR(E.START_DT,'YYYY-MM-DD'), ':2', TO_DATE( TO_CHAR(E.START_DT,'YYYY-MM-DD'),'YYYY-MM-DD') + 21, TRUNC(TO_DATE( TO_CHAR(E.START_DT,'YYYY-MM-DD'),'YYYY-MM-DD') + 21, 'DAY'), TO_CHAR(SYSDATE,'YYYY-MM-DD'), TO_CHAR(SYSDATE,'YYYY-MM-DD')
  FROM PS_STDNT_AID_ATRBT B, PS_STDNT_FA_TERM C, PS_CLASS_TBL_SE_VW E, PS_SCCPU_STDNT_BND A, PS_TERM_TBL J
  WHERE ( B.INSTITUTION = 'SPJC1'
     AND C.EFFDT =
        (SELECT MAX(C_ED.EFFDT) FROM PS_STDNT_FA_TERM C_ED
        WHERE C.EMPLID = C_ED.EMPLID
          AND C.INSTITUTION = C_ED.INSTITUTION
          AND C.STRM = C_ED.STRM
          AND C_ED.EFFDT <= SYSDATE)
    AND C.EFFSEQ =
        (SELECT MAX(C_ES.EFFSEQ) FROM PS_STDNT_FA_TERM C_ES
        WHERE C.EMPLID = C_ES.EMPLID
          AND C.INSTITUTION = C_ES.INSTITUTION
          AND C.STRM = C_ES.STRM
          AND C.EFFDT = C_ES.EFFDT)
     AND B.EMPLID = A.EMPLID
     AND B.EMPLID = C.EMPLID
     AND B.INSTITUTION = C.INSTITUTION
     AND B.AID_YEAR = C.AID_YEAR
     AND C.EMPLID = E.EMPLID
     AND C.INSTITUTION = E.INSTITUTION
     AND C.STRM = E.STRM
     AND E.ACAD_CAREER = C.ACAD_CAREER
     AND C.INSTITUTION = J.INSTITUTION
     AND C.STRM = J.STRM
     AND J.ACAD_CAREER = C.ACAD_CAREER
     AND C.STRM = :1
     AND C.EFF_STATUS = 'A'
     AND C.TERM_SRC <> 'N'
     AND E.START_DT = (SELECT MIN( F.START_DT)
  FROM PS_CLASS_TBL_SE_VW F
  WHERE F.EMPLID = E.EMPLID
     AND F.ACAD_CAREER = E.ACAD_CAREER
     AND F.INSTITUTION = E.INSTITUTION
     AND F.STRM = E.STRM
     AND F.UNT_PRGRSS_FA > 0
     AND F.STDNT_ENRL_STATUS = 'E'
     AND F.CRSE_GRADE_OFF NOT IN ('W','WF'))
     AND B.EMPLID NOT IN (SELECT G.EMPLID
  FROM PS_CLASS_TBL_SE_VW G
  WHERE G.EMPLID = E.EMPLID
     AND G.ACAD_CAREER = E.ACAD_CAREER
     AND G.INSTITUTION = E.INSTITUTION
     AND G.STRM = E.STRM
     AND G.STDNT_ENRL_STATUS = 'E'
     AND G.UNT_PRGRSS_FA > 0
     AND G.CRSE_GRADE_OFF NOT IN ('W','WF')
     AND G.START_DT < TO_DATE(:2,'YYYY-MM-DD'))
     AND EXISTS (SELECT 'X'
  FROM PS_STDNT_DISB_VW1 H, PS_ITEM_TYPE_FA I
  WHERE I.EFFDT =
        (SELECT MAX(I_ED.EFFDT) FROM PS_ITEM_TYPE_FA I_ED
        WHERE I.SETID = I_ED.SETID
          AND I.ITEM_TYPE = I_ED.ITEM_TYPE
          AND I.AID_YEAR = I_ED.AID_YEAR
          AND I_ED.EFFDT <= SYSDATE)
     AND H.EMPLID = C.EMPLID
     AND H.INSTITUTION = C.INSTITUTION
     AND H.AID_YEAR = C.AID_YEAR
     AND H.STRM = C.STRM
     AND H.ACAD_CAREER = C.ACAD_CAREER
     AND H.AID_YEAR = I.AID_YEAR
     AND H.ITEM_TYPE = I.ITEM_TYPE
     AND I.SETID = H.SETID
     AND H.ACCEPT_BALANCE > 0
     AND H.DISBURSED_BALANCE = 0
     AND I.DISBURSE_METHOD = 'A')
     AND NOT EXISTS (SELECT 'X'
  FROM PS_STDNT_FA_MSGS D
  WHERE D.EMPLID = B.EMPLID
     AND D.INSTITUTION = B.INSTITUTION
     AND D.AID_YEAR = B.AID_YEAR
     AND D.EDIT_MSG_TYPE = 'NSTRD'
     AND D.STRM = C.STRM)
     AND TO_DATE( E.START_DT,'YYYY-MM-DD') + 21 >= TRUNC(SYSDATE))
  ORDER BY 3
